{% extends "layout.html" %} {% block title %} Dashboard {% endblock %} {% block
main %}

<!-- Flash Messages Section -->
{% with messages = get_flashed_messages(with_categories=true) %} {% if messages
%}
<div class="flash-messages">
  {% for category, message in messages %}
  <div
    class="alert alert-{{ category }} alert-dismissible fade show"
    role="alert"
  >
    {{ message }}
    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  {% endfor %}
</div>
{% endif %} {% endwith %}

<div class="dashboard-main-text">
  <h2 class="main-title">Welcome Back, {{ username }}!</h2>
  <p>Your Budget and Savings Goals</p>
</div>
{% if not goals %}
<p class="no-goals-text">
  You have no goals yet. Add a new goal to get started!
</p>
<button class="btn btn-primary mt-3 add-goals-button" id="myBtn" type="submit">
  +
</button>
<!-- Modal created through W3schools https://www.w3schools.com/howto/howto_css_modals.asp -->
<!-- The Modal -->
<div id="myModal" class="modal">
  <!-- Modal content -->
  <div class="modal-content">
    <span class="close">&times;</span>
    <p>Select a type of goal:</p>
    <select id="goal-type-select" class="goal-type-select">
      <option value="" disabled selected>Select your option</option>
      <option value="budget">Budget Goal</option>
      <option value="savings">Savings Goal</option>
    </select>
  </div>
</div>
{% else %}
<div class="goals-container">
  {% for goal in goals %} {% set percentage = (goal.current_amount /
  goal.target_amount * 100) if goal.target_amount > 0 else 0 %} {% set
  display_percentage = 100 if percentage > 100 else percentage %}

  <div class="goal-card" data-goal-id="{{ goal.id }}" data-goal-type="{{ goal.goal_type }}">
    <!-- Delete button at top right -->
    <button type="button" class="delete-goal">
      <i class="bi bi-trash"></i>
    </button>

    <div class="goal-details">
      <div class="goal-info">
        <h3 class="goal-title">{{ goal.title }}</h3>
        <p class="goal-description">{{ goal.description }}</p>
        {% if goal.goal_type == 'savings' %}
        <p class="current-amount">Current Amount: ${{ goal.current_amount }}</p>
        <p class="goal-amount">Left to Save: ${{ (goal.target_amount - goal.current_amount)|round(2)}}</p>
        {% endif %} {% if goal.goal_type == 'budget' %}
        <p class="goal-amount">
          Budget Remaining: ${{ (goal.target_amount -
          goal.current_amount)|round(2) }}
        </p>
        {% endif %}
      </div>
      <!-- Progress Bar created with help from claude.ai -->
      <!-- Modified as needed to fit design -->
      <!-- Progress Bar Section -->
      <div class="progress-section">
        {% if goal.goal_type == 'savings' %}
        <p class="progress-label">Progress</p>
        {% else %}
        <p class="progress-label">Budget Used</p>
        {% endif %}
        <div class="progress-bar-container">
          <div
            class="progress-bar-fill"
            data-current="{{ goal.current_amount }}"
            data-target="{{ goal.target_amount }}"
            style="height: {{ display_percentage }}%"
          ></div>
        </div>
        <p class="progress-percentage">{{ "%.0f"|format(percentage) }}%</p>
      </div>
    </div>

    <!-- Bottom right controls -->
    <div class="value-change">
      <button type="button" class="decrement">-</button>
      <button type="button" class="increment">+</button>
      <input
        type="number"
        id="current-value"
        value="0"
        min="0"
        step="0.01"
        autocomplete="off"
      />
      <button type="button" class="confirm-value">
        <i class="bi bi-check"></i>
      </button>
    </div>
  </div>
  {% endfor %}
</div>
<button class="btn btn-primary mt-3 add-goals-button" id="myBtn" type="submit">
  +
</button>
<!-- Modal created through W3schools https://www.w3schools.com/howto/howto_css_modals.asp -->
<!-- The Modal -->
<div id="myModal" class="modal">
  <!-- Modal content -->
  <div class="modal-content">
    <span class="close">&times;</span>
    <p>Select a type of goal:</p>
    <select id="goal-type-select" class="goal-type-select">
      <option value="" disabled selected>Select your option</option>
      <option value="budget">Budget Goal</option>
      <option value="savings">Savings Goal</option>
    </select>
  </div>
</div>
{% endif %}
<script src="{{ url_for('static', filename='dashboard.js') }}"></script>
{% endblock %}
